<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Avatar Lip-Sync with Azure TTS</title>
    <link rel="stylesheet" href="styles.css">
    
    <!-- Three.js -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/OrbitControls.js"></script>
    
    <!-- Azure Speech SDK -->
    <script src="https://aka.ms/csspeech/jsbrowserpackageraw"></script>
    
    <!-- Config (contains Azure keys - injected at deploy time) -->
    <script src="config.js"></script>
</head>
<body>
    <div id="app-container">
        <!-- 3D Avatar Viewport -->
        <div id="avatar-viewport">
            <canvas id="avatar-canvas"></canvas>
            <div id="loading-overlay">
                <div class="spinner"></div>
                <p>Loading Avatar...</p>
            </div>
        </div>
        
        <!-- Control Panel -->
        <div id="control-panel">
            <h1>üé≠ 3D Avatar Lip-Sync</h1>
            <p class="subtitle">Azure TTS with 60fps BlendShapes</p>
            
            <!-- Connection Status -->
            <div id="status-bar">
                <span id="status-indicator" class="disconnected"></span>
                <span id="status-text">Initializing...</span>
            </div>
            
            <!-- Configuration Section (collapsed by default when config exists) -->
            <details id="config-section">
                <summary>üîß Azure Configuration</summary>
                <div class="config-content">
                    <div class="config-group">
                        <label>Speech API Key</label>
                        <input type="password" id="speech-key" placeholder="Your Azure Speech key">
                    </div>
                    <div class="config-group">
                        <label>Speech Region</label>
                        <input type="text" id="speech-region" placeholder="e.g., eastus">
                    </div>
                    <div class="config-group">
                        <label>OpenAI Endpoint</label>
                        <input type="text" id="openai-endpoint" placeholder="https://your-resource.openai.azure.com">
                    </div>
                    <div class="config-group">
                        <label>OpenAI API Key</label>
                        <input type="password" id="openai-key" placeholder="Your Azure OpenAI key">
                    </div>
                    <div class="config-group">
                        <label>Deployment Name</label>
                        <input type="text" id="openai-deployment" placeholder="e.g., gpt-4o">
                    </div>
                    <button id="connect-btn" class="primary-btn">Reconnect</button>
                    <p class="config-note">
                        <em>Keys are pre-configured via deployment. Only use this to override.</em>
                    </p>
                </div>
            </details>
            
            <!-- Voice Settings -->
            <details id="voice-section">
                <summary>üé§ Voice Settings</summary>
                <div class="config-content">
                    <div class="config-group">
                        <label>Voice</label>
                        <select id="voice-select">
                            <option value="en-US-AndrewMultilingualNeural">Andrew (Male)</option>
                            <option value="en-US-AvaMultilingualNeural">Ava (Female)</option>
                            <option value="en-US-BrianMultilingualNeural">Brian (Male)</option>
                            <option value="en-US-EmmaMultilingualNeural">Emma (Female)</option>
                            <option value="en-US-JennyNeural">Jenny (Female)</option>
                            <option value="en-US-GuyNeural">Guy (Male)</option>
                            <option value="en-US-AriaNeural">Aria (Female)</option>
                            <option value="en-US-DavisNeural">Davis (Male)</option>
                        </select>
                    </div>
                    <div class="config-group">
                        <label>Speed: <span id="speed-value">1.0x</span></label>
                        <input type="range" id="speed-slider" min="0.5" max="1.5" step="0.1" value="1.0">
                    </div>
                </div>
            </details>
            
            <!-- Chat Interface -->
            <div id="chat-section">
                <div id="chat-messages"></div>
                <div id="input-area">
                    <textarea id="user-input" placeholder="Type a message or click mic to speak..." rows="2"></textarea>
                    <div id="input-buttons">
                        <button id="mic-btn" class="icon-btn" title="Voice Input">üéôÔ∏è</button>
                        <button id="send-btn" class="icon-btn" title="Send">üì§</button>
                    </div>
                </div>
            </div>
            
            <!-- Debug Panel -->
            <details id="debug-section">
                <summary>üìä Debug Info</summary>
                <div id="debug-info">
                    <div class="debug-row">
                        <span>BlendShape Frames:</span>
                        <span id="debug-frames">0</span>
                    </div>
                    <div class="debug-row">
                        <span>Current Frame:</span>
                        <span id="debug-current">-</span>
                    </div>
                    <div class="debug-row">
                        <span>Active Shapes:</span>
                        <span id="debug-active">-</span>
                    </div>
                    <div class="debug-row">
                        <span>FPS:</span>
                        <span id="debug-fps">-</span>
                    </div>
                </div>
            </details>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="blendshape-mapper.js"></script>
    <script src="avatar-renderer.js"></script>
    <script src="azure-services-3d.js"></script>
    <script src="app.js"></script>
</body>
</html>
